{% comment %}
  Cart Item when active and in cart
{% endcomment %}

<tr id="cart_item_{{ item.id }}" class="store-cart-item">
  <td class="store-cart-thumb"><a href="{{ item.url }}"><img src="{{ item | img_url: 'medium' }}" alt="{{ item.title }}" /></a></td>
  <td class="store-cart-name"><a href="{{ item.url }}"><h3>{{ item.title }}</h3><small>{{ item.variant.option1 }}</small></a></td>
  <td class="store-cart-size"><small>Size</small>{{ item.variant.option2 }}</td>
  <td class="store-cart-price">
    <span class="price">
      <span class="price-currency">$</span><span class="price-dollars">{{ product.price | money_without_currency | replace_first '.', '</span><span class="store-details-cents">' }}</span>
    </span>
  </td>
  <td class="store-cart-q">
    <small>Quantity</small>
    <div class="form-select form-select--s">
      <select id="updates_{{ item.id }}" name=".s[]">
        {% for i in (1..10) %}
          <option value="{% i %}">{% i %}</option>
        {% endfor %}
      </select>
      <svg aria-hidden class="form-select-icn icn icn--arrow" role="img" viewbox="0 0 512 512">
        <use xlink:href="<%= image_path( 'icons.svg#arrow' ) %>"></use>
      </svg>
    </div>
  </td>
  <td class="store-cart-remove tar"><a id="remove_{{ item.id }}" href="/cart/change?line={{ item.id }}&quantity=0" class="btn btn--r">Remove</a></td>
</tr>

<script>
  $( '#remove_{{ item.id }}' ).on( 'click', function( e ) {
    $.post(
      '/cart/update.js',
      { updates: { {{ item.id }}: 0 } },
      function() {
        $( '#cart_item_{{ item.id }}' ).hide();
        $( '#cart_item_removed_{{ item.id }}' ).show();
      }
    );
    e.preventDefault();
  });
  $( '#cart_item_{{ item.id }}' ).show();
</script>

{% comment %}
  Cart Item when removed
{% endcomment %}

<tr id="cart_item_removed_{{ item.id }}" class="store-cart-item">
  <td class="store-cart-thumb"><a href="{{ item.url }}"><img src="{{ item | img_url: 'medium' }}" alt="{{ item.title }}" /></a></td>
  <td class="store-cart-name"><a href="{{ item.url }}"><h3>{{ item.title }}</h3><small>{{ item.variant.option1 }}</small></a></td>
  <td class="store-cart-size"><small>Size</small>{{ item.variant.option2 }}</td>
  <td class="store-cart-price tcs">Removed</td>
  <td class="store-cart-q"></td>
  <td class="store-cart-remove tar"><a id="undo_{{ item.id }}" href="/cart/change?line={{ item.id }}&quantity=1" class="tcs">Undo</a></td>
</tr>

<script>
  $( '#undo_{{ item.id }}' ).on( 'click', function( e ) {
    var newQ = $( '#updates_{{ item.id }}' ).val();
    if( !newQ || newQ < 1 ) newQ = 1;
    $.post(
      '/cart/update.js',
      { updates: { {{ item.id }}: newQ; } },
      function() {
        $( '#cart_item_{{ item.id }}' ).show();
        $( '#cart_item_removed_{{ item.id }}' ).hide();
      }
    );
    e.preventDefault();
  });
</script>

<script>
  $( '#cart_item_removed_{{ item.id }}' ).hide();
</script>
